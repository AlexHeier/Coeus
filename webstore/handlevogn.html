<html>
   <head>
      <title>Test </title>
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/ai.css">
   </head>
   <body>
        <!----- Header from main goes here ------>
        <header id="header"></header>

        <h1 style="margin-top: 60px;">Velkommen til handlevogn</h1>

        <div id="cart-container"></div>

        <!----- chat-box goes here ------>
        <div id="aiDiv"></div>
        
    <script>
      //used to get element from main.html file
      async function loadHTML(id, file, elementId) {
        try {
          const response = await fetch(file);
          if (!response.ok) throw new Error('Feil ved lasting av ' + file);
          const content = await response.text();
    
          // Parse innholdet til et DOM-objekt
          const parser = new DOMParser();
          const doc = parser.parseFromString(content, 'text/html');
    
          // Finn elementet med det spesifikke id-et fra det hentede dokumentet
          const element = doc.getElementById(elementId);
    
          if (element) {
            document.getElementById(id).innerHTML = element.innerHTML;
          } else {
            console.error(`Element med id "${elementId}" ble ikke funnet i ${file}.`);
          }
        } catch (error) {
        console.error(error);
      }
    }

      //loads elements from main
      loadHTML('header', 'index.html', 'header');
      loadHTML('aiDiv', 'index.html', 'aiDiv');

      // Shows shopping cart
      window.onload = displayCart;
      function displayCart() {
      let cart = JSON.parse(sessionStorage.getItem('cart')) || [];

      let cartContainer = document.getElementById('cart-container');
      let productElement = document.createElement('div');
      cartContainer.innerHTML = "";
        console.log(cart.length)
      if (cart.length == 0) {
        var totaltPris = 0;
        productElement.innerHTML = `
        <p>Handlekurven er tom.</p>
        <hr>
        `;
        cartContainer.appendChild(productElement);
      }
      else{
        var totaltPris = 0;
        cart.forEach(produkt => {
        totaltPris += produkt.price*produkt.antall;
          console.log(produkt.productname);
          
        let productElement = document.createElement('div');
        productElement.innerHTML = `
          <p><strong>Navn:</strong> ${produkt.productname}</p>
          <p><strong>Pris:</strong> ${produkt.price*produkt.antall} kr</p>
          <p><strong>Antall:</strong> ${produkt.antall}</p>
          <button id="${produkt.id}" onclick="removeFromCart(event)">Fjern produkt</button>
          <hr>
          `;
          cartContainer.appendChild(productElement);
      });
    }
    let prisElement = document.createElement('div');
    prisElement.innerHTML = `
        <p><strong>Totalpris:</strong> ${totaltPris} kr</p>
        <hr>
      `;
      cartContainer.appendChild(prisElement);
    } 

    // removes products from shopping cart
    function removeFromCart(evt) {
      var productId = parseInt(event.target.id, 10);
      let cart = JSON.parse(sessionStorage.getItem('cart')) || [];
      vognProdukt = cart.find(p => p.id === productId);
      if (vognProdukt.antall <= 1) {
        cart = cart.filter(product => product.id !== productId);
      }
      else {
        vognProdukt.antall = parseInt(vognProdukt.antall) - 1;
      }
      sessionStorage.setItem('cart', JSON.stringify(cart));

      displayCart();  // updates shopping cart
    }
    </script>
    </body>