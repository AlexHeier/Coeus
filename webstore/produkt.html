<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produktdetaljer</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/ai.css">
</head>
<body>
  <!----- Header from main goes here ------>
  <header id="header"></header>

  <h1 style="margin-top: 60px;" id="product-name">Laster produkt...</h1>
  <p id="product-description"></p>
  <p id="price">Price: </p>
  <img id="product-image" src="" alt="Produktbilde" style="max-width: 300px;">
  

  <form id="formVogn" onsubmit="handleSubmit(event)">
    <label for="">Antall: <input id="antallVogn" type="number" value="1"></label>
    <button type="submit" id="knappVogn">Legg i handlevogn</button>
  </form>

  <!----- chat-box goes here ------>
  <div id="aiDiv"></div>
  </body>

  <script>
    //used to get element from main.html file
      async function loadHTML(id, file, elementId) {
  try {
    const response = await fetch(file);
    if (!response.ok) throw new Error('Feil ved lasting av ' + file);
    const content = await response.text();
    
    // Parse innholdet til et DOM-objekt
    const parser = new DOMParser();
    const doc = parser.parseFromString(content, 'text/html');
    
    // Finn elementet med det spesifikke id-et fra det hentede dokumentet
    const element = doc.getElementById(elementId);
    
    if (element) {
      document.getElementById(id).innerHTML = element.innerHTML;
    } else {
      console.error(`Element med id "${elementId}" ble ikke funnet i ${file}.`);
    }
  } catch (error) {
    console.error(error);
  }
}

  //loads elements from main
  loadHTML('header', 'main.html', 'header');
  loadHTML('aiDiv', 'main.html', 'aiDiv');

    // Gets URL to get right product
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get('id');

  // Fetches json file from internet and finds right product
  fetch('https://raw.githubusercontent.com/GoogleChromeLabs/sample-pie-shop/refs/heads/master/src/data/products.json')
  .then(response => response.json())
  .then(data => {
    const produkter = data.products.data.items;
    const produkt = produkter.find(p => p.id === productId);

    if (produkt) {
      document.getElementById('product-name').textContent = produkt.name;
      document.getElementById('product-description').textContent = produkt.description;
      document.getElementById('price').textContent += produkt.price + '$';
      document.getElementById('product-image').src = produkt.image || "media/polka.jpg";

      document.getElementById('formVogn').addEventListener('submit', handleSubmit);

      //puts items in shopping cart
      function handleSubmit(event) {
        event.preventDefault();  

        let cart = JSON.parse(sessionStorage.getItem('cart')) || [];

        var antall = document.getElementById('antallVogn').value;

        vognProdukt = cart.find(p => p.id === productId);
        if(vognProdukt){
          vognProdukt.antall = parseInt(vognProdukt.antall) + parseInt(antall);
        }
        else{
          let product = {
            id: produkt.id,
            name: produkt.name,
            price: produkt.price,
            antall: antall
          };
        
          cart.push(product);  // Puts produkt in shopping cart
        }
        // saves cart
        sessionStorage.setItem('cart', JSON.stringify(cart));

        alert(produkt.name + " er lagt til i handlekurven!");
      }
    } else {
      document.getElementById('product-name').textContent = "Produkt ikke funnet!";
      document.getElementById('formVogn').style.display = "none";
    }
  })
  .catch(error => console.error('Det oppstod en feil:', error));
  </script>
</body>
