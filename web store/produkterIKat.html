<html>
   <head>
      <title>Test </title>
      <link rel="stylesheet" href="css/produkter.css">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/ai.css">
   </head>
   <body>
    <!----- Header from main goes here ------>
    <header id="header"></header>

    <h1 style="margin-top: 60px;">Produkter test:</h1>
        <div id="produkter-container"></div>

    <!----- chat-box goes here ------>
    <div id="aiDiv"></div>

    <script>
      //used to get element from main.html file
      async function loadHTML(id, file, elementId) {
        try {
          const response = await fetch(file);
          if (!response.ok) throw new Error('Feil ved lasting av ' + file);
          const content = await response.text();
    
          // Parse innholdet til et DOM-objekt
          const parser = new DOMParser();
          const doc = parser.parseFromString(content, 'text/html');
    
          // Finn elementet med det spesifikke id-et fra det hentede dokumentet
          const element = doc.getElementById(elementId);
    
          if (element) {
            document.getElementById(id).innerHTML = element.innerHTML;
          } else {
            console.error(`Element med id "${elementId}" ble ikke funnet i ${file}.`);
          }
        } catch (error) {
          console.error(error);
        }
      }

        //loads elements from main
        loadHTML('header', 'main.html', 'header');
        loadHTML('aiDiv', 'main.html', 'aiDiv');


        // Gets url to know what category we are in
        const urlParams = new URLSearchParams(window.location.search);
        const productCat = urlParams.get('category');

        // Gets all the products in category
        fetch('https://raw.githubusercontent.com/GoogleChromeLabs/sample-pie-shop/refs/heads/master/src/data/products.json')
        .then(response => response.json())
        .then(data => {
            const produkter = data.products.data.items;
            const produkterIKat = produkter.filter(p => p.category === productCat);

            visProdukter(produkterIKat);
        });

        function visProdukter(produkter) {
            const container = document.getElementById('produkter-container');
        
            produkter.forEach(produkter => {
   
                const produkterDiv = document.createElement('div');
                produkterDiv.classList.add('produkter');
            
                // text and button that takes us to product's page
                produkterDiv.innerHTML = `
                <h3>${produkter.name}</h3>
                <p>Price: ${produkter.price}$</p>
                <a href="produkt.html?id=${produkter.id}" >
                <img src="${"media/polka.jpg"}" alt="${produkter.name}">
                </a>
                `;   

                container.appendChild(produkterDiv);
            });

        }


    </script>
    <script src="js/script.js"></script>
    </body>